!function(t,e,a){"use strict";var i={};t.ARIAmodal=i,i.NS="ARIAmodal",i.AUTHOR="Scott O'Hara",i.VERSION="3.3.1",i.LICENSE="https://github.com/scottaohara/accessible_modal_window/blob/master/LICENSE";var o,d,l="modal-open",n=e.body,r=e.getElementsByTagName("main")[0]||n,s=e.querySelectorAll("[data-modal]"),u=e.querySelectorAll("body > *:not([data-modal])"),c=!1,b=!1,h="js-first-focus",g="js-last-focus";i.organizeDOM=function(){var t,e=n.firstElementChild||null;for(t=0;t<s.length;t++)n.insertBefore(s[t],e)},i.setupTrigger=function(){var t,a,o=e.querySelectorAll("[data-modal-open]");for(a=0;a<o.length;a++){var d=(t=o[a]).getAttribute("data-modal-open");if("BUTTON"!==t.nodeName){var l=t.getAttribute("href");t.setAttribute("role","button"),0===t.getAttribute("tabindex")||t.hasAttribute("href")||(t.tabIndex=0),""===d&&l&&(t.setAttribute("data-modal-open",l.split("#")[1]),d=l.split("#")[1])}d?(t.hasAttribute("disabled")&&!t.hasAttribute("data-modal-disabled")&&t.removeAttribute("disabled"),t.removeAttribute("hidden"),t.id=d+"__trigger-"+t.nodeName,t.addEventListener("click",i.openModal),t.addEventListener("keydown",i.keyEvents,!1)):console.warn('Missing target modal dialog - [data-modal-open="IDREF"]')}},i.setupModal=function(){var t;for(t=0;t<s.length;t++){var e,a=(e=s[t]).getAttribute("data-modal"),o=e.getAttribute("data-modal-class")||"a11y-modal",d=e.querySelector("h1")||e.querySelector("h2")||e.querySelector("h3")||e.querySelector("h4"),l=e.getAttribute("data-modal-label"),n=e.hasAttribute("data-modal-hide-heading"),r=e.querySelector("[data-modal-description]"),u=e.querySelector("[data-modal-document]");if("alert"===a?e.setAttribute("role","alertdialog"):e.setAttribute("role","dialog"),e.classList.add(o),e.setAttribute("hidden",""),e.tabIndex="-1",i.setupModalCloseBtn(e,o,a),e.hasAttribute("data-aria-modal")&&e.setAttribute("aria-modal","true"),u&&u.setAttribute("role","document"),r&&(r.id=r.id||"md_desc_"+Math.floor(999*Math.random())+1,e.setAttribute("aria-describedby",r.id)),l)e.setAttribute("aria-label",l);else if(d){var c=e.id+"_heading";d.classList.add(o+"__heading"),d.id=c,e.setAttribute("aria-labelledby",c),d.hasAttribute("data-autofocus")&&d.setAttribute("tabindex","-1")}else console.warn("Dialogs should have their purpose conveyed by a heading element (h1).");n&&e.querySelector("#"+d.id).classList.add("at-only");var b=e.querySelectorAll('button:not([hidden]):not([disabled]), [href]:not([hidden]), input:not([hidden]):not([type="hidden"]):not([disabled]), select:not([hidden]):not([disabled]), textarea:not([hidden]):not([disabled]), [tabindex="0"]:not([hidden]):not([disabled]), summary, [contenteditable]:not([hidden]), audio[controls], video[controls]');b[0].classList.add(h),b[b.length-1].classList.add(g)}},i.setupModalCloseBtn=function(t,a,o){var d,l=t.hasAttribute("data-modal-manual-close"),n=t.querySelectorAll("[data-modal-close-btn]"),r=t.getAttribute("data-modal-close"),s=t.getAttribute("data-modal-close-class");if(!l&&n.length<2){var u=e.createElement("button");u.setAttribute("type","button"),t.classList.add(a),u.classList.add(a+"__close-btn"),r||"alert"===o?(u.innerHTML=r,s&&u.classList.add(s)):(u.innerHTML="<span data-modal-x></span>",u.setAttribute("aria-label","Close"),u.classList.add("is-icon-btn")),"alert"!==o&&t.appendChild(u),u.addEventListener("click",i.closeModal)}for(d=0;d<n.length;d++)n[d].addEventListener("click",i.closeModal);e.addEventListener("keydown",i.keyEvents,!1)},i.openModal=function(t,a){var r,s=a||this.getAttribute("data-modal-open"),h=d=e.getElementById(s),g=d.querySelector("[autofocus]")||d.querySelector("[data-autofocus]");if(c=d.hasAttribute("aria-modal"),a&&(b=!0),a||(t.preventDefault(),o=this.id),g?h=g:d.hasAttribute("data-modal-close-focus")&&(h=d.querySelector('[class*="close-btn"]')),n.classList.contains(l))console.warn("It is not advised to open dialogs from within other dialogs. Instead consider replacing the contents of this dialog with new content. Or providing a stepped, or tabbed interface within this dialog.");else for(n.classList.add(l),r=0;r<u.length;r++)c||(u[r].hasAttribute("aria-hidden")&&u[r].setAttribute("data-keep-hidden",u[r].getAttribute("aria-hidden")),u[r].setAttribute("aria-hidden","true")),u[r].getAttribute("inert")?u[r].setAttribute("data-keep-inert",""):u[r].setAttribute("inert","true");return d.removeAttribute("hidden"),requestAnimationFrame(function(){h.focus()}),e.addEventListener("click",i.outsideClose,!1),e.addEventListener("touchend",i.outsideClose,!1),[o,d,b]},i.closeModal=function(t){var i,c,h=e.getElementById(o)||null;for(i=0;i<u.length;i++)u[i].hasAttribute("data-keep-inert")||u[i].removeAttribute("inert"),u[i].removeAttribute("data-keep-inert"),u[i].getAttribute("data-keep-hidden")?u[i].setAttribute("aria-hidden",u[i].getAttribute("data-keep-hidden")):u[i].removeAttribute("aria-hidden"),u[i].removeAttribute("data-keep-hidden");for(n.classList.remove(l),c=0;c<s.length;c++)s[c].hasAttribute("hidden")||s[c].setAttribute("hidden","");return null!==h?h.focus():r&&!b?(r.tabIndex=-1,r.focus()):(n.tabIndex=-1,n.focus()),[o=a,d=a,b=!1]},i.keyEvents=function(t){var a=t.keyCode||t.which;if(t.target.hasAttribute("data-modal-open"))switch(a){case 13:case 32:t.preventDefault(),t.target.click()}if(n.classList.contains(l)){switch(a){case 27:i.closeModal()}if(n.classList.contains(l))var o=d.querySelector("."+h),r=d.querySelector("."+g);e.activeElement.classList.contains(g)&&(9!==a||t.shiftKey||(t.preventDefault(),o.focus())),e.activeElement.classList.contains(h)&&9===a&&t.shiftKey&&(t.preventDefault(),r.focus())}},i.outsideClose=function(t){n.classList.contains(l)&&!t.target.hasAttribute("data-modal-open")&&(d.contains(t.target)||"alertdialog"===d.getAttribute("role")||i.closeModal())},i.autoLoad=function(){var a,o=e.querySelectorAll("[data-modal-auto]"),d=t.location.hash||null,l=!1;if(null!==d){if(""===(a=d.split("#")[1]))return!1;if("!null"===a)return!1;var n=e.getElementById(a)||null;null!==n&&("dialog"!==n.getAttribute("role")&&"alertdialog"!==n.getAttribute("role")||(l=!0))}l?(i.openModal(null,a),o.length>1&&console.warn("Only the modal indicated by the hash value will load.")):0!==o.length&&("dialog"===o[0].getAttribute("role")||"alertdialog"===o[0].getAttribute("role")?(a=o[0].id,i.openModal(null,a),o.length>1&&console.warn("Multiple modal dialogs can not auto load.")):"button"!==o[0].getAttribute("role")&&"BUTTON"!==o[0].tagName||(a=o[0].id,o[0].click())),0===o.length||e.getElementById(a).hasAttribute("data-modal-auto-persist")||t.location.replace("#!null")},i.init=function(){i.organizeDOM(),i.setupTrigger(),i.setupModal(),i.autoLoad()},i.init()}(window,document);
